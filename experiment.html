<!doctype html>
<html>
    <head>
        <title>My experiment</title>
        <link rel="shortcut icon" href="">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="jspsych-5.0.3/jspsych.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-survey-likert.js"></script>
        <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body>
    </body>
    <script>
  /* welcome messageblock */
    var welcome_block = {
      type: 'text',
      text: 'Welcome to the rating experiment. Press any key to begin.'
    };

/* instructions block */
    var instructions_block = {
      type: "text",
      text: "<p>In this experiment, two pictures will appear on the screen." +
          "</p><p>You have to rate them on the scale from 1 to" +
          " 7 depending on their structural similarity." +
          "<div class='left center-content'><img src='img/2.jpg'></img>" +
          "<div class='right center-content'><img src='img/3.jpg'></img>" +
          "<p>Press any key to begin.</p>",
      timing_post_trial: 2000
    };

/* define test block */
    var image_pool = ["1.JPG", "2.JPG", "3.JPG", "4.JPG", "5.JPG", "6.JPG","7.JPG"];

    var scale = ["Very Similar - 1", "2", "3", "4", "5", "6", "7 - Very different"];



/* trial needs to be repeated 120 times, pairs should not repeat */
  var experiment = [];
    experiment.push(welcome_block);
    experiment.push(instructions_block);

      for (var i = 1; i < 5; i++) {

        var random_image1 = jsPsych.randomization.sample(image_pool, 1, false);

        var random_image2 = jsPsych.randomization.sample(image_pool, 1, false);

        var trial = {
            type: 'survey-likert',
            preamble: ['<img src="'+random_image1+'" style="float: left; width: 45%"></img><img src="'+random_image2+'" style="float: right; width: 45%"></img><p style="clear: both;">'],
            questions: ['How similar are the structures?'],
            required: true,
            labels: [scale],
            data: [{image1ID: random_image1.image1ID, image2ID: random_image2.image2ID}]
          };
      experiment.push(trial);
    }


/* saving data code */

var subject_id = Math.floor(Math.random()*100000);

jsPsych.data.addProperties({
  subject: subject_id,
});


function saveData(filename, filedata){
  $.ajax({
    type: 'post',
    cache: false,
    url: 'save_data.php',
    data: {filename: filename, filedata: filedata}
  });
}






 /*create experiment timeline
    var timeline = [];
    timeline.push(welcome_block);
    timeline.push(instructions_block);
    timeline.push(trail);*/

/* start experiment */

    jsPsych.init({
         timeline: experiment,
         /*on_finish: function() { jsPsych.data.displayData(); },*/

         on_finish: function(data){ saveData("filename.csv", jsPsych.data.dataAsCSV()) }
      });
</script>
</html>
