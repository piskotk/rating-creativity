<!doctype html>
<html>
    <head>
        <title>My experiment</title>
        <link rel="shortcut icon" href="">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="js/jquery.js"></script>
        <script src="jspsych-5.0.3/jspsych.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-call-function.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-survey-likert.js"></script>
        <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body>
    </body>
    <script>
  /* welcome messageblock */
    var welcome_block = {
      type: 'text',
      text: 'Welcome to the rating experiment. Press any key to begin.'
    };

/* instructions block */
    var instructions_block = {
      type: "text",
      text: "<p>In this experiment, two pictures will appear on the screen." +
          "</p><p>You have to rate them on the scale from 1 to" +
          " 7 depending on their structural similarity." +
          "<div class='left center-content'><img src='img/2.jpg'></img>" +
          "<div class='right center-content'><img src='img/3.jpg'></img>" +
          "<p>Press any key to begin.</p>",
      timing_post_trial: 2000
    };

/* define test block */
    var image_pool = ["1.JPG", "2.JPG", "3.JPG", "4.JPG", "5.JPG", "6.JPG", "7.JPG"];

    var scale = ["Very Similar - 1", "2", "3", "4", "5", "6", "7 - Very different"];

    function pairsGenerator(inputSet, k) {
      return (function subsetRecurser(subset, inputSetIndex, subsetIndex, result) {
        inputSetIndex = inputSetIndex || 0
        subsetIndex = subsetIndex || 0
        subset = subset || []
        result = result || []

        if (subsetIndex === k) {
          result.push(subset.slice())
          return
        }

        if (inputSetIndex >= inputSet.length) {
          return
        }

        subset[subsetIndex] = inputSet[inputSetIndex]
        subsetRecurser(subset, inputSetIndex + 1, subsetIndex + 1, result)
        subsetRecurser(subset, inputSetIndex + 1, subsetIndex, result)

        return result
      })()
    };

    const generatedPairs = pairsGenerator(image_pool, 2);
    var generatedPairs1 = pairsGenerator(image_pool, 2);
    console.log(generatedPairs);
    console.log(generatedPairs1);

    function randomNumberGenerator(min, max) {
        return Math.floor(Math.random() * (max))
      }
    function uniqueRangeGenerator(min, max) {
        const range = []

        while (range.length < (max)) {
          var randomNumber = randomNumberGenerator(min, max)

          if (range.indexOf(randomNumber) === -1) {
            range.push(randomNumber)
          }
        }
        return range
      };

      const uniqueRange = uniqueRangeGenerator(0, generatedPairs.length);
      var uniqueRange1 = uniqueRangeGenerator(0, generatedPairs.length);
      console.log(uniqueRange);



  /*function randomNumberGenerator(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min
    }
    function uniqueRangeGenerator(min, max) {
      const range = []

      while (range.length < (max - min + 1)) {
        var randomNumber = randomNumberGenerator(min, max)

        if (range.indexOf(randomNumber) === -1) {
          range.push(randomNumber)
        }
      }
      return range
    };

    const uniqueRange = uniqueRangeGenerator(0, generatedPairs.length);
    var uniqueRange1 = uniqueRangeGenerator(0, generatedPairs.length);
    console.log(uniqueRange);*/


  /* function randomNorepeats(array) {
      var copy = array.slice(0);
      return function() {
        if (copy.length < 1) { copy = array.slice(0); }
        var index = Math.floor(Math.random() * copy.length);
        var item = copy[index];
        copy.splice(index, 1);
        return item;
      };
    }; */

  /*  function randomNorepeats(array) {
       var copy = array.slice(0);
       return function() {
         if (copy.length < 1) { copy = array.slice(0); }
         var index = Math.floor(Math.random() * copy.length);
         var item = copy[index];
         copy.splice(index, 1);
         return item;
       };
     };

    var rdnNumb = randomNorepeats(uniqueRange1);
    var rdnNumb1 = rdnNumb(); */



/* trial needs to be repeated 120 times, pairs should not repeat */
  var experiment = [];
    experiment.push(welcome_block);
    experiment.push(instructions_block);

      for (var i = 1; i < 10; i++) {

      /*  var pair = generatedPairs[];

        for (var j = 0; j < generatedPairs.length; j++) {
          if (pair[j] === )
        }
        var pair = [];

        var pickAPair = function () {
          var pair = generatedPairs[Math.floor(math.random() * generatedPairs.length)];
          return pair;
        };*/

/* for loop that x is not repeated while the participant does the study


    unique_random_numbers = []
      while (unique_random_numbers.length < generatedPairs.length) {
        var random_number = Math.floor((Math.random() * generatedPairs.length));
          if (unique_random_numbers.indexOf(random_number) === -1) {
          unique_random_numbers.push(random_number);
        }
      };*/

      /*int a[] = new int[n];
      String line = br.readLine();
      String[] strs = line.trim().split(",");
      for (int i = 0; i < n; i++) {
        a[i] = Integer.parseInt(strs[i]);
      } */

      var random_number = Math.floor((Math.random() * generatedPairs.length));

      var generatedPairs2 = pairsGenerator(image_pool, 2);






      var image1 = generatedPairs[random_number][0];
      var image2 = generatedPairs[random_number][1];
      console.log(random_number);
      console.log(image1);
      console.log(image2);







      /*
      var image1 = generatedPairs1[random_number][0];
      var image2 = generatedPairs1[random_number][1];

      var x = Math.floor((Math.random() * generatedPairs.length) + 1);
      var x = Math.floor(Math.random() * (generatedPairs.length));
      var x, j;
      for (j = 0; j < uniqueRange.length; j++) {
        x += uniqueRange[j];
        console.log(x)
      };

var y = Math.floor(Math.random() * (generatedPairs.length));
      var image1 = generatedPairs[y][0];
      var image2 = generatedPairs[y][1];*/


        var trial = {
            type: 'survey-likert',
            preamble: ['<img src="'+image1+'" style="float: left; width: 45%"></img><img src="'+image2+'" style="float: right; width: 45%"></img><p style="clear: both;">'],
            questions: ['How similar are the structures?'],
            required: true,
            labels: [scale],
          };
      experiment.push(trial);
    }


/* saving data code */

var subject_id = Math.floor(Math.random()*100000);

jsPsych.data.addProperties({
  subject: subject_id,
});


function saveData(filename, filedata){
  $.ajax({
    type: 'post',
    cache: false,
    url: 'save_data.php',
    data: {filename: filename, filedata: filedata}
  });
}






 /*create experiment timeline
    var timeline = [];
    timeline.push(welcome_block);
    timeline.push(instructions_block);
    timeline.push(trail);*/

/* start experiment */

    jsPsych.init({
         timeline: experiment,
         /*on_finish: function() { jsPsych.data.displayData(); },*/

         on_finish: function(data){ saveData("filename.csv", jsPsych.data.dataAsCSV()) }
      });
</script>
</html>
